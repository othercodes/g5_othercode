{% extends '@nucleus/partials/particle.html.twig' %}

{% block particle %}
    <div class="terminal">

        <div class="term-section" id="term-home">
            <p>Oops, parece que algo ha salido mal!</p>
            <p><span>Type 'help' + <kbd>Enter</kbd> -- for available commands.</span></p>
        </div>


        <div class="term-section" id="term-error">
            <p>Command not found!</p>
            <p><span>Type 'help' + <kbd>Enter</kbd> -- for available commands.</span></p>
        </div>


        <div class="term-section" id="term-help">
            <h2><span>&raquo;Help?</span></h2>
            <p><span>Type [command] + <kbd>Enter</kbd></span></p>
            <ul>
                <li>'home' -- Thats obvious!</li>
                <li>'help' -- displays this list</li>
            </ul>
        </div>

        <span class="command">
            <span class="hostname">othercode@user</span>:<span class="pwd">~</span>$<input type="text"/>
        </span>
    </div>
{% endblock %}

{% block javascript_footer %}
    {% if particle.enabled %}
        {{ parent() }}

        <script type="text/javascript">

            (function (e) {
                "use strict";
                e.fn.textTyper = function (t) {
                    var n = {
                        typingClass: "typing",
                        beforeAnimation: function () {
                        },
                        afterAnimation: function () {
                        },
                        speed: 10,
                        nextLineDelay: 400,
                        startsFrom: 0,
                        repeatAnimation: false,
                        repeatDelay: 4e3,
                        repeatTimes: 1,
                        cursorHtml: '<span class="cursor">|</span>'
                    }, r = e.extend({}, n, t);
                    this.each(function () {
                        var t = e(this), n = 1, i = "typingCursor";
                        var s = t, o = s.length, u = [];
                        while (o--) {
                            u[o] = e.trim(e(s[o]).html());
                            e(s[o]).html("")
                        }
                        t.init = function (e) {
                            var n = r.beforeAnimation;
                            if (n) n();
                            t.animate(0)
                        };
                        t.animate = function (o) {
                            var a = s[o], f = r.typingClass, l = r.startsFrom;
                            e(a).addClass(f);
                            var c = setInterval(function () {
                                var f = r.cursorHtml;
                                f = e("<div>").append(e(f).addClass(i)).html();
                                e(a).html(u[o].substr(0, l) + f);
                                l++;
                                if (u[o].length < l) {
                                    clearInterval(c);
                                    o++;
                                    if (s[o]) {
                                        setTimeout(function () {
                                            e(a).html(u[o - 1]);
                                            t.animate(o)
                                        }, r.nextLineDelay)
                                    } else {
                                        e(a).find("." + i).remove();
                                        if (r.repeatAnimation && (r.repeatTimes == 0 || n < r.repeatTimes)) {
                                            setTimeout(function () {
                                                t.animate(0);
                                                n++
                                            }, r.repeatDelay)
                                        } else {
                                            var h = r.afterAnimation;
                                            if (h) h()
                                        }
                                    }
                                }
                            }, r.speed)
                        };
                        t.init()
                    });
                    return this
                }
            })(jQuery)


            // Let's do it!!
            jQuery(document).ready(function () {

                jQuery('.command').hide();
                jQuery('input[type="text"]').focus();

                jQuery('#term-home').addClass('open');
                jQuery('#term-home').textTyper({
                    speed: 1,
                    afterAnimation: function () {
                        jQuery('.command').fadeIn();
                        jQuery('input[type="text"]').focus();
                        jQuery('input[type="text"]').val('');
                    }
                });

                var sectionArray = [];
                jQuery('.term-section').each(function (i, e) {
                    sectionArray.push(jQuery(e).attr('id'));
                });

                // Command Input------------------------------

                jQuery('input[type="text"]').keyup(function (e) {

                    if (e.which == 13) { // ENTER key pressed

                        jQuery('.command').hide();

                        var destination = jQuery('input[type="text"]').val();

                        // Display section with id == destination and hide all others
                        jQuery('div[id="term-' + destination + '"]').addClass('open').siblings().removeClass('open');

                        // If destination does not match our array of section ids, display error section
                        if (jQuery.inArray(destination, sectionArray) == -1) {
                            jQuery('#error').addClass('open');
                            jQuery('#error').siblings().removeClass('open');
                        }

                        // All sections with class .open init textTyper
                        jQuery('.open').textTyper({
                            speed: 20,
                            afterAnimation: function () {
                                jQuery('.command').fadeIn();
                                jQuery('input[type="text"]').focus();
                                jQuery('input[type="text"]').val('');
                            }
                        });

                    }// end if ENTER key pressed

                });// end keyup function

                // End Command Input-----------------------------

            });
        </script>
    {% endif %}
{% endblock %}